<% content_for :head do %>
  <%= stylesheet_link_tag "home", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "home", "data-turbo-track": "reload", defer: true %>
<% end %>

<div class="home-container">
  <!-- Header Section -->
  <header class="home-header">
    <div class="container">
      <div class="header-content">
        <div class="logo-container">
          <%= image_tag 'logo.png', alt: 'PIN - PlayInNear', class: 'site-logo' %>
        </div>
        <div class="header-auth">
          <% if user_signed_in? %>
            <span class="user-name"><%= current_user.name %></span>
            <% if current_user.admin? || current_user.super_admin? %>
              <%= link_to 'ActiveAdmin', admin_root_path, class: "auth-link", target: '_blank' %>
            <% else %>
              <%= link_to 'My Tournaments', admin_tournaments_path, class: "auth-link", target: '_blank' %>
            <% end %>
            <%= button_to t('devise.shared.sign_out'), destroy_user_session_path, method: :delete, class: "auth-link signout-btn", form: { class: "signout-form" } %>
          <% else %>
            <%= link_to t('devise.shared.sign_in'), new_user_session_path, class: "auth-link" %>
            <%= link_to t('devise.shared.sign_up'), new_user_registration_path, class: "auth-link auth-link-primary" %>
          <% end %>
        </div>
      </div>
    </div>
  </header>

  <!-- Filters Section -->
  <section class="filters-section">
    <div class="container">
      <form id="tournament-filters" method="get" action="<%= root_path %>" class="filters-form">
        <div class="filters-grid">
          <!-- Sport Filter -->
          <div class="filter-group">
            <label for="sport_id" class="filter-label"><%= t('home.filters.sport') %></label>
            <select name="sport_id" id="sport_id" class="filter-select">
              <option value="" <%= 'selected' unless @selected_sport_id.present? %>><%= t('home.filters.all_sports') %></option>
              <% @sports.each do |sport| %>
                <option value="<%= sport.id %>" <%= 'selected' if @selected_sport_id == sport.id.to_s %>>
                  <%= sport.icon %> <%= sport.name %>
                </option>
              <% end %>
            </select>
          </div>

          <!-- Date Filter -->
          <div class="filter-group">
            <label for="start_date" class="filter-label"><%= t('home.filters.start_date') %></label>
            <input type="date" name="start_date" id="start_date" class="filter-input" value="<%= @start_date %>">
          </div>

          <!-- Search Filter -->
          <div class="filter-group filter-group-search">
            <label for="search" class="filter-label"><%= t('home.filters.search') %></label>
            <input type="text" name="search" id="search" class="filter-input" placeholder="<%= t('home.filters.search_placeholder') %>" value="<%= @search_query %>">
          </div>

          <!-- Location Button -->
          <div class="filter-group">
            <label class="filter-label">&nbsp;</label>
            <button type="button" id="get-location-btn" class="btn-location">
              <%= t('home.filters.use_location') %>
            </button>
          </div>

          <!-- Submit Button -->
          <div class="filter-group">
            <label class="filter-label">&nbsp;</label>
            <button type="submit" class="btn-filter"><%= t('home.filters.filter') %></button>
          </div>
        </div>

        <!-- Hidden fields for location -->
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
      </form>

      <!-- Location Status -->
      <div id="location-status" class="location-status" style="display: none;" data-location-active="<%= t('home.filters.location_active') %>">
        <span id="location-text"></span>
        <button type="button" id="clear-location" class="btn-clear-location"><%= t('home.filters.clear') %></button>
      </div>
    </div>
  </section>

  <!-- Tournaments Section -->
  <section class="tournaments-section">
    <div class="container">
      <div class="tournaments-header">
        <h2 class="section-title">
          <% if @selected_sport_id.present? %>
            <% selected_sport = @sports.find { |s| s.id.to_s == @selected_sport_id.to_s } %>
            <%= selected_sport&.name || t('home.tournaments.title') %>
          <% else %>
            <%= t('home.tournaments.title') %>
          <% end %>
          <span class="tournament-count"><%= t('home.tournaments.count', count: @tournaments.size) %></span>
        </h2>
      </div>

      <% if @tournaments.any? %>
        <div class="tournaments-grid" id="tournaments-grid" data-has-more="<%= @has_more %>" data-current-page="<%= @current_page %>">
          <% @tournaments.each_with_index do |tournament, index| %>
            <%= render partial: 'tournament_card', locals: { tournament: tournament, index: index } %>
          <% end %>
        </div>
      <% else %>
        <div class="no-tournaments">
          <div class="no-tournaments-icon">üèüÔ∏è</div>
          <h3><%= t('home.tournaments.no_tournaments') %></h3>
          <p><%= t('home.tournaments.no_tournaments_message') %></p>
        </div>
      <% end %>
    </div>
  </section>
</div>
